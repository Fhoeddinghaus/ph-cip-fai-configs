#!/bin/bash

error=0; trap 'error=$(($?>$error?$?:$error))' ERR # save maximum error code

#####################################################################
# create "shk" maintenance account on CIP clients
#  -> $files/archives/$CLASS.tar/home/"$name"/.ssh/authorized_keys <- 
# should contain correct pubkey of an "shk" account on the server

name="shk"
uid=1000
# hash function of password as generated by crypt
pass="QAWRG63RBizqk"

# customize user groups
$ROOTCMD groupadd -g 1000 "$name" &> /dev/null
$ROOTCMD groupadd -g 1001 cip &> /dev/null
$ROOTCMD groupadd -g 21000 smail &> /dev/null

# create users
$ROOTCMD useradd -g sudo -G "$name" -p "$pass" -d "/home/$name" -s /bin/bash -c "CIP maintenance account" -u "$uid" "$name"

# repair access rights upon installation
$ROOTCMD chown -R "$name:$name" "/home/$name"

exit $error
