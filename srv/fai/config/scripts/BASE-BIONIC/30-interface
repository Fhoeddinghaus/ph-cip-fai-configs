#! /bin/bash

error=0; trap 'error=$(($?>$error?$?:$error))' ERR # save maximum error code

# set hostname (local part of FQDN)
echo $HOSTNAME > $target/etc/hostname

# configure wired adapter with static IP
if [ $FAI_ACTION = "install" -o $FAI_ACTION = "dirinstall" ]; then
	[ -n "$IPADDR" ] && cat > $target/etc/systemd/network/wired.network <<-EOF
	# generated by FAI
	[Match]
	Name=en*
	
	[Network]
	Address=$IPADDR/26
	Gateway=$GATEWAYS
	EOF
	[ -n "$NETWORK" ] && echo "localnet $NETWORK" > $target/etc/networks
	if [ ! -L $target/etc/resolv.conf -a -e /etc/resolv.conf ]; then
		cp -p /etc/resolv.conf $target/etc
	fi
fi

# enable networking service
$ROOTCMD systemctl enable systemd-networkd.service
$ROOTCMD systemctl start systemd-networkd.service

exit $error
